$(function(){function e(){var e;$.ajax({url:"ajax/session_check.php",success:function(e){e==0?t():n(e)}})}function t(){currentPage="home";$(".content").html("<div class='loader'><img src='assets/img/ajax-loader.gif' height=16 alt='Chargement en cours'/> Chargement en cours...</div>");$.ajax({url:"ajax/battles.php",async:!1,beforeSend:function(){$("#battle").fadeOut("slow");$("#battle").remove()},success:function(e){$(".content").html(e)}})}function n(e){currentPage="battle";$.ajax({url:"ajax/battle.php",type:"GET",data:{id:e},beforeSend:function(){$("#battles").fadeOut("slow")},success:function(e){$(".content").hide().html(e).fadeIn("slow")}})}function r(){currentPage="add";$.ajax({url:"ajax/addInterface.php",type:"GET",beforeSend:function(){$("#battles").fadeOut("slow")},success:function(e){$(".content").hide().html(e).fadeIn("slow")}})}function i(){$.ajax({url:"ajax/addBattle.php",type:"POST",dataType:"json",data:$(".content form").serialize(),success:function(e){console.log(e.statut);$(".messageBar").show();$(".messageBar").addClass(e.statut);$(".messageBar p").html(e.message)},error:function(e,t,n){alert(e.responseText)}})}function s(e,t){$.ajax({url:"ajax/vote.php",type:"GET",dataType:"json",data:{id:e,item:t},success:function(r){r.statut=="Vote"?o(r.score1,r.score2,t):n(e)}})}function o(e,t,n){$('.element[data-name!="'+n+'"]').fadeTo("fast",.4);$("#result .score1").html(e+"%");$("#result .score2").html(t+"%");$("#result").fadeIn(500)}e();$("#navMobile").on("click",function(){$(".hideContent").fadeIn(100);$("#nav").transition({x:"280px"})});$(".hideContent").on("click",function(){$(".hideContent").hide();$("#nav").transition({x:"0"});$("#nav").transition({marginLeft:"-280px"})});$("body").on("click",".category li",function(){currentPage!=="home"&&t();if($(this).attr("class").split(" ")[1]!="active"){$(".category li").removeClass("active");var e=$(this).attr("class");$(this).addClass("active");if(e=="grey"){console.log("grey");$(".content ul.battles li.battle").show()}else $(".content ul.battles li:not(."+e+")").hide(function(){console.log("pas grey +");console.log($(".content ul.battles"));$(".content ul.battles li."+e).show();$(".content ul.battles li.add").show()});$(".category li div.select").remove();$(".category li a span.icon").removeClass("active");$(this).prepend('<div class="select '+e+'"></div>');$("a span.icon",this).addClass("active");$(".category li div.select").transition({marginLeft:"0"},function(){$(".hideContent").is(":visible")&&$(".hideContent").trigger("click")})}});$("#search input").keypress(function(){var e=$(this).val();(e.length<=0||e.charAt(0)!="#")&&$(this).val("#")});$(".content").delegate(".messageBar a","click",function(){$(this).parent().fadeOut(300)});$(".content").delegate(".up","click",function(e){var t=$(this).prev().val();$(this).next().attr("src",t)});$(".content").delegate(".validForm","click",function(e){i()});$(".content").on("click",".back",function(){t()});$(".content").on("click","#battles a",function(){var e=$(this).parent().attr("data-id");n(e)});$("body").on("click",".addItem",function(){r()});$(".content").on("click",".element a",function(){var e=$(this).parent().attr("data-name"),t=$(this).parent().parent().parent().attr("data-id");s(t,e)})});